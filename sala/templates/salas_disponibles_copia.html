{% extends 'base.html' %}

{% block title %} Solicitudes de Catequistas {% endblock %}

{% block content %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="date" name="fecha" id="fecha">

    <select id="hora_inicio" name="hora_inicio"></select>
    <select id="hora_fin" name="hora_fin"></select>

    <button type="submit">Guardar</button>
</form>

{% for sala in todas_salas %}
    {% if sala in salas_ocupadas %}
        {% for reserva in reservas_salas_ocupadas %}
            {% if reserva.sala == sala %}
                <div class="sala ocupada" data-reserva="{{ reserva }}">
                    <p>{{ sala }}</p>
                </div>
            {% endif %}
        {% endfor %}
    {% else %}
        <div class="sala libre">
            
            <div class="boton-modal" data-sala-id="{{ sala.id }}">
                <label for="btn-modal"><p>{{ sala }}</p></label>
            </div>

        </div>
    {% endif %}
{% endfor %}

<input type="checkbox" id="btn-modal">
<div class="container-modal">
    <div class="content-modal">
        <h2>Reservar la sala</h2>
        <p>¿Estás seguro de que quieres reservar la sala?</p>
        <button id="confirmarReserva">Confirmar Reserva</button>
        <div class="btn-cerrar">
            <label for="btn-modal">Cerrar</label>
        </div>
    </div>
    <label for="btn-modal" class="cerrar-modal"></label>
</div>

<script>
    var selectInicio = document.getElementById("hora_inicio");
    var selectFin = document.getElementById("hora_fin");
    for (var hora = 8; hora < 24; hora++) {
        for (var minuto = 0; minuto < 60; minuto += 30) {
            var hora_str = (hora < 10 ? "0" : "") + hora;
            var minuto_str = (minuto === 0 ? "00" : minuto);
            var opcion = document.createElement("option");
            opcion.text = hora_str + ":" + minuto_str;
            opcion.value = hora_str + ":" + minuto_str;
            selectInicio.add(opcion);
            selectFin.add(opcion.cloneNode(true)); // Clonamos la opción para el selector de fin
        }
    }

    
</script>

<style>
    .sala {
        width: 100px;
        height: 100px;
        border: 1px solid #000;
        text-align: center;
        line-height: 100px;
        margin: 10px;
        float: left;
        position: relative; /* Añadido para posición absoluta del título */
    }

    
    .ocupada {
        background-color: lightcoral;
        color: white;
    }

    .libre {
        background-color: lightgreen;
        cursor: pointer;
    }

    .libre label {
        cursor: pointer;
    }

    .libre:hover {
        background-color: rgb(137, 151, 156);
    }

    /* Estilo para el título emergente */
    .ocupada[data-reserva]:hover:after {
        content: attr(data-reserva);
        background-color: rgb(174, 162, 162);
        color: white;
        padding: 5px;
        position: absolute;
        left: 0;
        bottom: -100%; /* muestra el cuadro encima de la sala */
        white-space: nowrap; /* evitar que el texto se envuelva */
        z-index: 1; /* asegura que esté por encima de otras capas */
    }

    #btn-modal{
        display: none;
    }
    .container-modal{
        width: 100%;
        height: 100vh;
        position: fixed;
        top: 0; left: 0;
        background-color: rgba(144, 148, 150, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
    }
    #btn-modal:checked ~ .container-modal{
        display: flex;
    }
    .content-modal{
        width: 100%;
        max-width: 400px;
        padding: 20px;
        background-color: #fff;
        border-radius: 4px;
    }
    .content-modal h2{
        margin-bottom: 15px;
    }
    .content-modal p{
        padding: 15px 0px;
        border-top: 1px solid #dbdbdb;
        border-bottom: 1px solid #dbdbdb;
    }
    .content-modal .btn-cerrar{
        width: 100%;
        margin-top: 15px;
        display: flex;
        justify-content: flex-end;
    }
    .content-modal .btn-cerrar label{
        padding: 7px 10px;
        background-color: #5488a3;
        color: #fff;
        border-radius: 4px;
        cursor: pointer;
        transition: all 300ms ease;
    }
    .content-modal .btn-cerrar label:hover{
        background-color:#185E83;
    }
    .cerrar-modal{
        width:100%;
        height: 100vh;
        position: absolute;
        top:0; left: 0;
        z-index: -1;
    }
    @media screen and (max-width:800px) {
        .content-modal{
            width: 90%;
        }
    }

</style>

{% endblock %}
